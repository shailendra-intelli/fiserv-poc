{"ast":null,"code":"/*! @azure/msal-browser v3.1.0 2023-09-05 */\n'use strict';\n\nimport { AccountEntity, CacheManager } from '@azure/msal-common';\nimport { EventType } from './EventType.mjs';\n\n/*\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\nclass EventHandler {\n  constructor(logger, browserCrypto) {\n    this.eventCallbacks = new Map();\n    this.logger = logger;\n    this.browserCrypto = browserCrypto;\n    this.listeningToStorageEvents = false;\n    this.handleAccountCacheChange = this.handleAccountCacheChange.bind(this);\n  }\n  /**\n   * Adds event callbacks to array\n   * @param callback\n   */\n  addEventCallback(callback) {\n    if (typeof window !== \"undefined\") {\n      const callbackId = this.browserCrypto.createNewGuid();\n      this.eventCallbacks.set(callbackId, callback);\n      this.logger.verbose(`Event callback registered with id: ${callbackId}`);\n      return callbackId;\n    }\n    return null;\n  }\n  /**\n   * Removes callback with provided id from callback array\n   * @param callbackId\n   */\n  removeEventCallback(callbackId) {\n    this.eventCallbacks.delete(callbackId);\n    this.logger.verbose(`Event callback ${callbackId} removed.`);\n  }\n  /**\n   * Adds event listener that emits an event when a user account is added or removed from localstorage in a different browser tab or window\n   */\n  enableAccountStorageEvents() {\n    if (typeof window === \"undefined\") {\n      return;\n    }\n    if (!this.listeningToStorageEvents) {\n      this.logger.verbose(\"Adding account storage listener.\");\n      this.listeningToStorageEvents = true;\n      window.addEventListener(\"storage\", this.handleAccountCacheChange);\n    } else {\n      this.logger.verbose(\"Account storage listener already registered.\");\n    }\n  }\n  /**\n   * Removes event listener that emits an event when a user account is added or removed from localstorage in a different browser tab or window\n   */\n  disableAccountStorageEvents() {\n    if (typeof window === \"undefined\") {\n      return;\n    }\n    if (this.listeningToStorageEvents) {\n      this.logger.verbose(\"Removing account storage listener.\");\n      window.removeEventListener(\"storage\", this.handleAccountCacheChange);\n      this.listeningToStorageEvents = false;\n    } else {\n      this.logger.verbose(\"No account storage listener registered.\");\n    }\n  }\n  /**\n   * Emits events by calling callback with event message\n   * @param eventType\n   * @param interactionType\n   * @param payload\n   * @param error\n   */\n  emitEvent(eventType, interactionType, payload, error) {\n    if (typeof window !== \"undefined\") {\n      const message = {\n        eventType: eventType,\n        interactionType: interactionType || null,\n        payload: payload || null,\n        error: error || null,\n        timestamp: Date.now()\n      };\n      this.logger.info(`Emitting event: ${eventType}`);\n      this.eventCallbacks.forEach((callback, callbackId) => {\n        this.logger.verbose(`Emitting event to callback ${callbackId}: ${eventType}`);\n        callback.apply(null, [message]);\n      });\n    }\n  }\n  /**\n   * Emit account added/removed events when cached accounts are changed in a different tab or frame\n   */\n  handleAccountCacheChange(e) {\n    try {\n      const cacheValue = e.newValue || e.oldValue;\n      if (!cacheValue) {\n        return;\n      }\n      const parsedValue = JSON.parse(cacheValue);\n      if (typeof parsedValue !== \"object\" || !AccountEntity.isAccountEntity(parsedValue)) {\n        return;\n      }\n      const accountEntity = CacheManager.toObject(new AccountEntity(), parsedValue);\n      const accountInfo = accountEntity.getAccountInfo();\n      if (!e.oldValue && e.newValue) {\n        this.logger.info(\"Account was added to cache in a different window\");\n        this.emitEvent(EventType.ACCOUNT_ADDED, undefined, accountInfo);\n      } else if (!e.newValue && e.oldValue) {\n        this.logger.info(\"Account was removed from cache in a different window\");\n        this.emitEvent(EventType.ACCOUNT_REMOVED, undefined, accountInfo);\n      }\n    } catch (e) {\n      return;\n    }\n  }\n}\nexport { EventHandler };","map":{"version":3,"names":["EventHandler","constructor","logger","browserCrypto","eventCallbacks","Map","handleAccountCacheChange","bind","addEventCallback","callback","window","set","callbackId","verbose","enableAccountStorageEvents"],"sources":["D:\\react-typescript\\intelli-gui\\node_modules\\@azure\\msal-browser\\src\\event\\EventHandler.ts"],"sourcesContent":["/*\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport {\n    ICrypto,\n    Logger,\n    AccountEntity,\n    CacheManager,\n} from \"@azure/msal-common\";\nimport { InteractionType } from \"../utils/BrowserConstants\";\nimport {\n    EventCallbackFunction,\n    EventError,\n    EventMessage,\n    EventPayload,\n} from \"./EventMessage\";\nimport { EventType } from \"./EventType\";\n\nexport class EventHandler {\n    // Callback for subscribing to events\n    private eventCallbacks: Map<string, EventCallbackFunction>;\n    private logger: Logger;\n    private browserCrypto: ICrypto;\n    private listeningToStorageEvents: boolean;\n\n    constructor(logger: Logger, browserCrypto: ICrypto) {\n        this.eventCallbacks = new Map();\n        this.logger = logger;\n        this.browserCrypto = browserCrypto;\n        this.listeningToStorageEvents = false;\n        this.handleAccountCacheChange =\n            this.handleAccountCacheChange.bind(this);\n    }\n\n    /**\n     * Adds event callbacks to array\n     * @param callback\n     */\n    addEventCallback(callback: EventCallbackFunction): string | null {\n        if (typeof window !== \"undefined\") {\n            const callbackId = this.browserCrypto.createNewGuid();\n            this.eventCallbacks.set(callbackId, callback);\n            this.logger.verbose(\n                `Event callback registered with id: ${callbackId}`\n            );\n\n            return callbackId;\n        }\n\n        return null;\n    }\n\n    /**\n     * Removes callback with provided id from callback array\n     * @param callbackId\n     */\n    removeEventCallback(callbackId: string): void {\n        this.eventCallbacks.delete(callbackId);\n        this.logger.verbose(`Event callback ${callbackId} removed.`);\n    }\n\n    /**\n     * Adds event listener that emits an event when a user account is added or removed from localstorage in a different browser tab or window\n     */\n    enableAccountStorageEvents(): void {\n        if (typeof window === \"undefined\") {\n            return;\n        }\n\n        if (!this.listeningToStorageEvents) {\n            this.logger.verbose(\"Adding account storage listener.\");\n            this.listeningToStorageEvents = true;\n            window.addEventListener(\"storage\", this.handleAccountCacheChange);\n        } else {\n            this.logger.verbose(\"Account storage listener already registered.\");\n        }\n    }\n\n    /**\n     * Removes event listener that emits an event when a user account is added or removed from localstorage in a different browser tab or window\n     */\n    disableAccountStorageEvents(): void {\n        if (typeof window === \"undefined\") {\n            return;\n        }\n\n        if (this.listeningToStorageEvents) {\n            this.logger.verbose(\"Removing account storage listener.\");\n            window.removeEventListener(\n                \"storage\",\n                this.handleAccountCacheChange\n            );\n            this.listeningToStorageEvents = false;\n        } else {\n            this.logger.verbose(\"No account storage listener registered.\");\n        }\n    }\n\n    /**\n     * Emits events by calling callback with event message\n     * @param eventType\n     * @param interactionType\n     * @param payload\n     * @param error\n     */\n    emitEvent(\n        eventType: EventType,\n        interactionType?: InteractionType,\n        payload?: EventPayload,\n        error?: EventError\n    ): void {\n        if (typeof window !== \"undefined\") {\n            const message: EventMessage = {\n                eventType: eventType,\n                interactionType: interactionType || null,\n                payload: payload || null,\n                error: error || null,\n                timestamp: Date.now(),\n            };\n\n            this.logger.info(`Emitting event: ${eventType}`);\n\n            this.eventCallbacks.forEach(\n                (callback: EventCallbackFunction, callbackId: string) => {\n                    this.logger.verbose(\n                        `Emitting event to callback ${callbackId}: ${eventType}`\n                    );\n                    callback.apply(null, [message]);\n                }\n            );\n        }\n    }\n\n    /**\n     * Emit account added/removed events when cached accounts are changed in a different tab or frame\n     */\n    private handleAccountCacheChange(e: StorageEvent): void {\n        try {\n            const cacheValue = e.newValue || e.oldValue;\n            if (!cacheValue) {\n                return;\n            }\n            const parsedValue = JSON.parse(cacheValue);\n            if (\n                typeof parsedValue !== \"object\" ||\n                !AccountEntity.isAccountEntity(parsedValue)\n            ) {\n                return;\n            }\n            const accountEntity = CacheManager.toObject<AccountEntity>(\n                new AccountEntity(),\n                parsedValue\n            );\n            const accountInfo = accountEntity.getAccountInfo();\n            if (!e.oldValue && e.newValue) {\n                this.logger.info(\n                    \"Account was added to cache in a different window\"\n                );\n                this.emitEvent(EventType.ACCOUNT_ADDED, undefined, accountInfo);\n            } else if (!e.newValue && e.oldValue) {\n                this.logger.info(\n                    \"Account was removed from cache in a different window\"\n                );\n                this.emitEvent(\n                    EventType.ACCOUNT_REMOVED,\n                    undefined,\n                    accountInfo\n                );\n            }\n        } catch (e) {\n            return;\n        }\n    }\n}\n"],"mappings":";;;;;;AAKA;AAMA;AACA;AAMA;AAKW,MAAAA,YAAgB;EACvBC,YAAAC,MAAA,EAAAC,aAA+B;IACxB,IAAC,CAAAC,cAAA,OAAAC,GAAkC;IAE9B,KAAAH,MAAA,GAAMA,MAAE;IASpB,KAAAC,aAAA,GAAAA,aAAA;;oCAGG,KAAAG,wBAAA,CAAAC,IAAA;EACH;EAcA;;;AAGG;EACHC,iBAAAC,QAAoB;IAKpB,WAAAC,MAAA;;MAEG,KAAAN,cAAA,CAAAO,GAAA,CAAAC,UAAA,EAAAH,QAAA;MACH,KAAAP,MAAA,CAAAW,OAAA,uCAAkCD,UAAA;MAclC,OAAAA,UAAA;;IAEG;EACH;EAiBA;;;;;;IAMG,KAAAV,MAAA,CAAAW,OAAA,mBAAAD,UAAA;;EA6BH;;AAEG;EACHE,0BAAgCA,CAAA;IAqCnC,WAAAJ,MAAA"},"metadata":{},"sourceType":"module","externalDependencies":[]}