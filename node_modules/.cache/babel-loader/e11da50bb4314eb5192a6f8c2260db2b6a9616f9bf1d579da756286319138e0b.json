{"ast":null,"code":"/*! @azure/msal-browser v3.1.0 2023-09-05 */\n'use strict';\n\nimport { PerformanceEvents, Constants, AuthError } from '@azure/msal-common';\nimport { StandardInteractionClient } from './StandardInteractionClient.mjs';\nimport { createBrowserAuthError } from '../error/BrowserAuthError.mjs';\nimport { InteractionType } from '../utils/BrowserConstants.mjs';\nimport { SilentHandler } from '../interaction_handler/SilentHandler.mjs';\nimport { HybridSpaAuthorizationCodeClient } from './HybridSpaAuthorizationCodeClient.mjs';\nimport { authCodeRequired, silentLogoutUnsupported } from '../error/BrowserAuthErrorCodes.mjs';\n\n/*\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\nclass SilentAuthCodeClient extends StandardInteractionClient {\n  constructor(config, storageImpl, browserCrypto, logger, eventHandler, navigationClient, apiId, performanceClient, nativeMessageHandler, correlationId) {\n    super(config, storageImpl, browserCrypto, logger, eventHandler, navigationClient, performanceClient, nativeMessageHandler, correlationId);\n    this.apiId = apiId;\n  }\n  /**\n   * Acquires a token silently by redeeming an authorization code against the /token endpoint\n   * @param request\n   */\n  async acquireToken(request) {\n    this.logger.trace(\"SilentAuthCodeClient.acquireToken called\");\n    // Auth code payload is required\n    if (!request.code) {\n      throw createBrowserAuthError(authCodeRequired);\n    }\n    // Create silent request\n    this.performanceClient.setPreQueueTime(PerformanceEvents.StandardInteractionClientInitializeAuthorizationRequest, request.correlationId);\n    const silentRequest = await this.initializeAuthorizationRequest(request, InteractionType.Silent);\n    this.browserStorage.updateCacheEntries(silentRequest.state, silentRequest.nonce, silentRequest.authority, silentRequest.loginHint || Constants.EMPTY_STRING, silentRequest.account || null);\n    const serverTelemetryManager = this.initializeServerTelemetryManager(this.apiId);\n    try {\n      // Create auth code request (PKCE not needed)\n      const authCodeRequest = {\n        ...silentRequest,\n        code: request.code\n      };\n      // Initialize the client\n      this.performanceClient.setPreQueueTime(PerformanceEvents.StandardInteractionClientGetClientConfiguration, request.correlationId);\n      const clientConfig = await this.getClientConfiguration(serverTelemetryManager, silentRequest.authority);\n      const authClient = new HybridSpaAuthorizationCodeClient(clientConfig);\n      this.logger.verbose(\"Auth code client created\");\n      // Create silent handler\n      const silentHandler = new SilentHandler(authClient, this.browserStorage, authCodeRequest, this.logger, this.config.system, this.performanceClient);\n      // Handle auth code parameters from request\n      return silentHandler.handleCodeResponseFromServer({\n        code: request.code,\n        msgraph_host: request.msGraphHost,\n        cloud_graph_host_name: request.cloudGraphHostName,\n        cloud_instance_host_name: request.cloudInstanceHostName\n      }, silentRequest.state, authClient.authority, this.networkClient, false);\n    } catch (e) {\n      if (e instanceof AuthError) {\n        e.setCorrelationId(this.correlationId);\n        serverTelemetryManager.cacheFailedRequest(e);\n      }\n      this.browserStorage.cleanRequestByState(silentRequest.state);\n      throw e;\n    }\n  }\n  /**\n   * Currently Unsupported\n   */\n  logout() {\n    // Synchronous so we must reject\n    return Promise.reject(createBrowserAuthError(silentLogoutUnsupported));\n  }\n}\nexport { SilentAuthCodeClient };","map":{"version":3,"names":["SilentAuthCodeClient","StandardInteractionClient","constructor","config","storageImpl","browserCrypto","logger","eventHandler","navigationClient","apiId","performanceClient","nativeMessageHandler","correlationId","trace","request","code"],"sources":["D:\\react-typescript\\intelli-gui\\node_modules\\@azure\\msal-browser\\src\\interaction_client\\SilentAuthCodeClient.ts"],"sourcesContent":["/*\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport {\n    ICrypto,\n    Logger,\n    CommonAuthorizationCodeRequest,\n    AuthError,\n    Constants,\n    IPerformanceClient,\n    PerformanceEvents,\n} from \"@azure/msal-common\";\nimport { StandardInteractionClient } from \"./StandardInteractionClient\";\nimport { AuthorizationUrlRequest } from \"../request/AuthorizationUrlRequest\";\nimport { BrowserConfiguration } from \"../config/Configuration\";\nimport { BrowserCacheManager } from \"../cache/BrowserCacheManager\";\nimport { EventHandler } from \"../event/EventHandler\";\nimport { INavigationClient } from \"../navigation/INavigationClient\";\nimport {\n    createBrowserAuthError,\n    BrowserAuthErrorCodes,\n} from \"../error/BrowserAuthError\";\nimport { InteractionType, ApiId } from \"../utils/BrowserConstants\";\nimport { SilentHandler } from \"../interaction_handler/SilentHandler\";\nimport { AuthorizationCodeRequest } from \"../request/AuthorizationCodeRequest\";\nimport { HybridSpaAuthorizationCodeClient } from \"./HybridSpaAuthorizationCodeClient\";\nimport { NativeMessageHandler } from \"../broker/nativeBroker/NativeMessageHandler\";\nimport { AuthenticationResult } from \"../response/AuthenticationResult\";\n\nexport class SilentAuthCodeClient extends StandardInteractionClient {\n    private apiId: ApiId;\n\n    constructor(\n        config: BrowserConfiguration,\n        storageImpl: BrowserCacheManager,\n        browserCrypto: ICrypto,\n        logger: Logger,\n        eventHandler: EventHandler,\n        navigationClient: INavigationClient,\n        apiId: ApiId,\n        performanceClient: IPerformanceClient,\n        nativeMessageHandler?: NativeMessageHandler,\n        correlationId?: string\n    ) {\n        super(\n            config,\n            storageImpl,\n            browserCrypto,\n            logger,\n            eventHandler,\n            navigationClient,\n            performanceClient,\n            nativeMessageHandler,\n            correlationId\n        );\n        this.apiId = apiId;\n    }\n\n    /**\n     * Acquires a token silently by redeeming an authorization code against the /token endpoint\n     * @param request\n     */\n    async acquireToken(\n        request: AuthorizationCodeRequest\n    ): Promise<AuthenticationResult> {\n        this.logger.trace(\"SilentAuthCodeClient.acquireToken called\");\n\n        // Auth code payload is required\n        if (!request.code) {\n            throw createBrowserAuthError(\n                BrowserAuthErrorCodes.authCodeRequired\n            );\n        }\n\n        // Create silent request\n        this.performanceClient.setPreQueueTime(\n            PerformanceEvents.StandardInteractionClientInitializeAuthorizationRequest,\n            request.correlationId\n        );\n        const silentRequest: AuthorizationUrlRequest =\n            await this.initializeAuthorizationRequest(\n                request,\n                InteractionType.Silent\n            );\n        this.browserStorage.updateCacheEntries(\n            silentRequest.state,\n            silentRequest.nonce,\n            silentRequest.authority,\n            silentRequest.loginHint || Constants.EMPTY_STRING,\n            silentRequest.account || null\n        );\n\n        const serverTelemetryManager = this.initializeServerTelemetryManager(\n            this.apiId\n        );\n\n        try {\n            // Create auth code request (PKCE not needed)\n            const authCodeRequest: CommonAuthorizationCodeRequest = {\n                ...silentRequest,\n                code: request.code,\n            };\n\n            // Initialize the client\n            this.performanceClient.setPreQueueTime(\n                PerformanceEvents.StandardInteractionClientGetClientConfiguration,\n                request.correlationId\n            );\n            const clientConfig = await this.getClientConfiguration(\n                serverTelemetryManager,\n                silentRequest.authority\n            );\n            const authClient: HybridSpaAuthorizationCodeClient =\n                new HybridSpaAuthorizationCodeClient(clientConfig);\n            this.logger.verbose(\"Auth code client created\");\n\n            // Create silent handler\n            const silentHandler = new SilentHandler(\n                authClient,\n                this.browserStorage,\n                authCodeRequest,\n                this.logger,\n                this.config.system,\n                this.performanceClient\n            );\n\n            // Handle auth code parameters from request\n            return silentHandler.handleCodeResponseFromServer(\n                {\n                    code: request.code,\n                    msgraph_host: request.msGraphHost,\n                    cloud_graph_host_name: request.cloudGraphHostName,\n                    cloud_instance_host_name: request.cloudInstanceHostName,\n                },\n                silentRequest.state,\n                authClient.authority,\n                this.networkClient,\n                false\n            );\n        } catch (e) {\n            if (e instanceof AuthError) {\n                (e as AuthError).setCorrelationId(this.correlationId);\n                serverTelemetryManager.cacheFailedRequest(e);\n            }\n            this.browserStorage.cleanRequestByState(silentRequest.state);\n            throw e;\n        }\n    }\n\n    /**\n     * Currently Unsupported\n     */\n    logout(): Promise<void> {\n        // Synchronous so we must reject\n        return Promise.reject(\n            createBrowserAuthError(\n                BrowserAuthErrorCodes.silentLogoutUnsupported\n            )\n        );\n    }\n}\n"],"mappings":";;;;;;;;;;;AAKA;AASA;AAEA;AACA;AAca,MAAAA,oBAAA,SAAAC,yBAAsD;EAC/DC,YAAAC,MAAqB,EAAAC,WAAA,EAAAC,aAAA,EAAAC,MAAA,EAAAC,YAAA,EAAAC,gBAAA,EAAAC,KAAA,EAAAC,iBAAA,EAAAC,oBAAA,EAAAC,aAAA;IAGjB,MAAAT,MAAA,EAAMC,WAAsB,EAAAC,aACjB,EAAAC,MAAA,EAAAC,YAAA,EAAAC,gBACX,EAAAE,iBACM,EAAAC,oBACN,EAAAC,aAA0B;IAqB9B,KAAAH,KAAA,GAAAA,KAAA;;;AAGG;;AAwFH;;IAEG,KAAAH,MAAA,CAAAO,KAAA;IACH;IAQH,KAAAC,OAAA,CAAAC,IAAA"},"metadata":{},"sourceType":"module","externalDependencies":[]}