!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).JSONRepair={})}(this,function(t){"use strict";class w extends Error{constructor(t,e){super(t+" at position "+e),this.position=e}}const a=125,e=32,x=10,y=9,O=13,N=8,J=12,S=34,r=39,j=48,I=57,k=65,m=97,T=70,$=102,h=160,d=8192,l=8202,E=8239,R=8287,U=12288,n=8220,o=8221,c=8216,i=8217,f=96,u=180;function F(t){return t>=j&&t<=I}function q(t){return s.test(t)}const s=/^[,:[\]/{}()\n+]$/;function z(t){return A.test(t)||t&&D(t.charCodeAt(0))}const A=/^[[{\w-]$/;function B(t){return t===e||t===x||t===y||t===O}function D(t){return G(t)||K(t)}function G(t){return t===S||t===n||t===o}function H(t){return t===S}function K(t){return t===r||t===c||t===i||t===f||t===u}function L(t){return t===r}function M(t,e,r){r=2<arguments.length&&void 0!==r&&r,e=t.lastIndexOf(e);return-1!==e?t.substring(0,e)+(r?"":t.substring(e+1)):t}function P(t,e){let r=t.length;if(!B(t.charCodeAt(r-1)))return t+e;for(;B(t.charCodeAt(r-1));)r--;return t.substring(0,r)+e+t.substring(r)}const Q={"\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t"},V={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"};t.JSONRepairError=w,t.jsonrepair=function(s){let A=0,C="";if(!c())throw new w("Unexpected end of json string",s.length);var t=i(44);if(t&&g(),z(s[A])&&/[,\n][ \t\r]*$/.test(C)){t||(C=P(C,","));{let t=!0,e=!0;for(;e;)t?t=!1:i(44)||(C=P(C,",")),e=c();e||(C=M(C,","));C="[\n".concat(C,"\n]")}}else t&&(C=M(C,","));for(;s.charCodeAt(A)===a||93===s.charCodeAt(A);)A++,g();if(A>=s.length)return C;throw new w("Unexpected character "+JSON.stringify(s[A]),A);function c(){g();var t=function(){if(123!==s.charCodeAt(A))return!1;{C+="{",A++,g();let e=!0;for(;A<s.length&&s.charCodeAt(A)!==a;){let t;if(e?(t=!0,e=!1):((t=i(44))||(C=P(C,",")),g()),!(v()||f())){s.charCodeAt(A)===a||123===s.charCodeAt(A)||93===s.charCodeAt(A)||91===s.charCodeAt(A)||void 0===s[A]?C=M(C,","):function(){throw new w("Object key expected",A)}();break}g();var r=i(58),n=A>=s.length,o=(r||(z(s[A])||n?C=P(C,":"):u()),c());o||(r||n?C+="null":u())}return s.charCodeAt(A)===a?(C+="}",A++):C=P(C,"}"),!0}}()||function(){if(91!==s.charCodeAt(A))return!1;{C+="[",A++,g();let t=!0;for(;A<s.length&&93!==s.charCodeAt(A);){t?t=!1:i(44)||(C=P(C,","));var e=c();if(!e){C=M(C,",");break}}return 93===s.charCodeAt(A)?(C+="]",A++):C=P(C,"]"),!0}}()||v()||function(){var t=A;if(45===s.charCodeAt(A)&&(A++,o(t)))return!0;for(;F(s.charCodeAt(A));)A++;if(46===s.charCodeAt(A)){if(A++,o(t))return!0;for(;F(s.charCodeAt(A));)A++}if(101===s.charCodeAt(A)||69===s.charCodeAt(A)){if(A++,45!==s.charCodeAt(A)&&43!==s.charCodeAt(A)||A++,o(t))return!0;for(;F(s.charCodeAt(A));)A++}{var e;if(A>t)return t=s.slice(t,A),e=/^0\d/.test(t),C+=e?'"'.concat(t,'"'):t,!0}return!1}()||r("true","true")||r("false","false")||r("null","null")||r("True","true")||r("False","false")||r("None","null")||f();return g(),t}function g(){A;let t=e();for(;t=(t=function(){if(47===s.charCodeAt(A)&&42===s.charCodeAt(A+1)){for(;A<s.length&&!function(t,e){return"*"===t[e]&&"/"===t[e+1]}(s,A);)A++;A+=2}else{if(47!==s.charCodeAt(A)||47!==s.charCodeAt(A+1))return!1;for(;A<s.length&&s.charCodeAt(A)!==x;)A++}return!0}())&&e(););A}function e(){let t="";for(var e,r;(e=B(s.charCodeAt(A)))||(r=s.charCodeAt(A))===h||r>=d&&r<=l||r===E||r===R||r===U;)t+=e?s[A]:" ",A++;return 0<t.length&&(C+=t,!0)}function i(t){return s.charCodeAt(A)===t&&(C+=s[A],A++,!0)}function b(){92===s.charCodeAt(A)&&A++}function v(t){var r,n,o=0<arguments.length&&void 0!==t&&t;let c=92===s.charCodeAt(A);if(c&&(A++,c=!0),D(s.charCodeAt(A))){var i=H(s.charCodeAt(A))?H:L(s.charCodeAt(A))?L:K(s.charCodeAt(A))?K:G,f=A,u=C.length;let e='"';for(A++;;){if(A>=s.length)return o?(e=P(e,'"'),C+=e,!0):(A=f,C=C.substring(0,u),v(!0));if(i(s.charCodeAt(A))){var a=A,h=e.length;if(e+='"',A++,C+=e,g(),o||A>=s.length||q(s.charAt(A))||D(s.charCodeAt(A)))return p(),!0;if(q(s.charAt(function(t){let e=t;for(;0<e&&B(s.charCodeAt(e));)e--;return e}(a-1))))return A=f,C=C.substring(0,u),v(!0);C=C.substring(0,u),A=a+1,e=e.substring(0,h)+"\\"+e.substring(h)}else{if(o&&q(s[A]))return e=P(e,'"'),C+=e,p(),!0;if(92===s.charCodeAt(A)){a=s.charAt(A+1);if(void 0!==V[a])e+=s.slice(A,A+2),A+=2;else if("u"===a){let t=2;for(;t<6&&((n=s.charCodeAt(A+t))>=j&&n<=I||n>=k&&n<=T||n>=m&&n<=$);)t++;if(6===t)e+=s.slice(A,A+6),A+=6;else{if(!(A+t>=s.length))throw h=void 0,h=s.slice(A,A+6),new w('Invalid unicode character "'.concat(h,'"'),A);A=s.length}}else e+=a,A+=2}else{var d=s.charAt(A),l=s.charCodeAt(A);if(l===S&&92!==s.charCodeAt(A-1))e+="\\"+d;else if((r=l)===x||r===O||r===y||r===N||r===J)e+=Q[d];else{if(!(32<=(r=l)&&r<=1114111))throw l=void 0,l=d,new w("Invalid character "+JSON.stringify(l),A);e+=d}A++}}c&&b()}}return!1}function p(){let t=!1;for(g();43===s.charCodeAt(A);){t=!0,A++,g();var e=(C=M(C,'"',!0)).length,r=v();C=r?(r=C,e=e,n=1,r.substring(0,e)+r.substring(e+n)):P(C,'"')}var n;t}function r(t,e){return s.slice(A,A+t.length)===t&&(C+=e,A+=t.length,!0)}function f(){for(var t=A;A<s.length&&!q(s[A])&&!D(s.charCodeAt(A));)A++;if(A>t){if(40===s.charCodeAt(A))A++,c(),41===s.charCodeAt(A)&&(A++,59===s.charCodeAt(A))&&A++;else{for(;B(s.charCodeAt(A-1))&&0<A;)A--;t=s.slice(t,A);C+="undefined"===t?"null":JSON.stringify(t),s.charCodeAt(A)===S&&A++}return!0}}function n(t){if(!F(s.charCodeAt(A)))throw t=s.slice(t,A),new w("Invalid number '".concat(t,"', expecting a digit ").concat(s[A]?"but got '".concat(s[A],"'"):"but reached end of input"),A)}function o(t){if(A>=s.length)return C+=s.slice(t,A)+"0",1;n(t)}function u(){throw new w("Colon expected",A)}}});